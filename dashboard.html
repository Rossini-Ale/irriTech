<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - IrriTech</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#"
          ><i class="bi bi-flower1"></i> IrriTech</a
        >
        <button id="logoutButton" class="btn btn-outline-light">Sair</button>
      </div>
    </nav>

    <main class="container mt-4 mb-5">
      <div
        class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2"
      >
        <h1>Painel de Controle</h1>
        <button class="btn btn-primary" id="btnAbrirModalSistema">
          <i class="bi bi-plus-circle-fill"></i> Adicionar Sistema
        </button>
      </div>

      <div class="row g-4">
        <div class="col-lg col-md-6">
          <div class="card text-center">
            <div class="card-body p-4">
              <h5 class="card-title">
                <i class="bi bi-moisture"></i> Umidade do Solo
              </h5>
              <p class="card-value" id="valorUmidadeSolo">-- %</p>
            </div>
          </div>
        </div>
        <div class="col-lg col-md-6">
          <div class="card text-center">
            <div class="card-body p-4">
              <h5 class="card-title">
                <i class="bi bi-thermometer-half"></i> Temperatura do Ar
              </h5>
              <p class="card-value" id="valorTemperaturaAr">-- °C</p>
            </div>
          </div>
        </div>
        <div class="col-lg col-md-6">
          <div class="card text-center">
            <div class="card-body p-4">
              <h5 class="card-title">
                <i class="bi bi-cloud-sun"></i> Evapotranspiração
              </h5>
              <p class="card-value" id="valorET">--</p>
              <small class="text-muted">mm/dia</small>
            </div>
          </div>
        </div>
        <div class="col-lg col-md-6">
          <div class="card text-center">
            <div class="card-body p-4">
              <h5 class="card-title">
                <i class="bi bi-droplet-half"></i> Umidade do Ar
              </h5>
              <p class="card-value" id="valorUmidadeAr">-- %</p>
            </div>
          </div>
        </div>
        <div class="col-lg col-md-6">
          <div class="card text-center" id="cardStatusBomba">
            <div class="card-body p-4">
              <h5 class="card-title">
                <i class="bi bi-water"></i> Status da Bomba
              </h5>
              <p class="card-value fs-1" id="statusBomba">--</p>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4 mt-2">
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header bg-white fw-bold">Controle Manual</div>
            <div class="card-body d-grid gap-3 p-4">
              <button class="btn btn-success btn-lg" id="ligarBombaBtn">
                <i class="bi bi-play-circle-fill"></i> Ligar
              </button>
              <button class="btn btn-danger btn-lg" id="desligarBombaBtn">
                <i class="bi bi-stop-circle-fill"></i> Desligar
              </button>
            </div>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header bg-white fw-bold">
              Histórico (Últimas 24 horas)
            </div>
            <div class="card-body p-4">
              <canvas id="graficoHistorico"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="card mt-4">
        <div class="card-header bg-white fw-bold">
          Log de Eventos de Irrigação
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th scope="col">Data e Hora</th>
                  <th scope="col">Ação</th>
                  <th scope="col">Motivo</th>
                </tr>
              </thead>
              <tbody id="tabelaEventos"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <div
      class="modal fade"
      id="modalAdicionarSistema"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Adicionar Novo Sistema de Irrigação</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formAdicionarSistema">
              <div class="mb-3">
                <label for="nome_sistema" class="form-label"
                  >Nome para o Sistema</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="nome_sistema"
                  placeholder="Ex: Horta da Varanda"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="channel_id" class="form-label"
                  >ID do Canal do ThingSpeak</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="channel_id"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="read_api_key" class="form-label"
                  >Chave de API de Leitura (Read API Key)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="read_api_key"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="cultura_sistema" class="form-label"
                  >Cultura Inicial (Opcional)</label
                >
                <select class="form-select" id="cultura_sistema">
                  <option value="">Selecione uma cultura...</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              form="formAdicionarSistema"
            >
              Salvar Sistema
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="dashboard.js"></script>
  </body>
</html>
